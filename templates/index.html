<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/static/styles.css">
    <link
      href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <style>
      body, html {
    height: 100%;
    margin: 0;
  }
  
  .bg {
    /* The image used */
  
    /* Full height */
    height: 100%; 
    /* Center and scale the image nicely */
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
  }
.title{
    height: auto;
    width: auto;
    padding: 5px;
    color: rgb(100, 100, 96);
    background-color: rgb(251, 255, 1);
}
/* .card{
    padding-top: 280px;
} */
h1 {
    color: black;
    margin-bottom: 0;
    margin-top: 0;
    text-align: center;
    font-size: 40px;
}

h3 {
    color: black;
    font-size: 20px;
    margin-top: 3px;
    text-align: center;
}

#chatbox {
    width: 100%;
    margin-top: 60px;
}

#userInput {
    width: 100%;
    margin-top: 60px;
}
input[type=text]{
    height: 50px;
    width: 100%;
    background: transparent;
}
input[type=submit]{
    height: 50px;
    width: 100%;
}
input:focus {
    outline: none;
  }
#textInput {
    border: none;
    border-bottom: 3px solid #009688;
    font-family: monospace;
    font-size: 17px;
}

#buttonInput {
    padding: 3px;
    font-family: monospace;
    font-size: 17px;
}

.userText {
    margin-top: 15px;
    color: white;
    font-family: monospace;
    font-size: 17px;
    text-align: right;
    line-height: 30px;
}

.userText span {
    background-color: #595c5c;
    padding: 10px;
    border-radius: 2px;
}

.botText {
    margin-top: 15px;
    color: white;
    font-family: monospace;
    font-size: 17px;
    text-align: left;
    line-height: 30px;
}

.botText span {
    background-color: #6e90ee;
    padding: 10px;
    border-radius: 2px;
}

#tidbit {
    position:absolute;
    bottom:0;
    right:0;
    width: 300px;
}
    </style>
  </head>
  <body>
    <div class="bg">
    <h1 class="title text-5xl font-bold">hot-pizz</h1>
    <div class="card md:mx-48 lg:mx-48 xl:mx-48">
      <div id="chatbox" class="">
        <p class="botText"><span>Please try typing full sentences as I am still learning!</span></p>
        <p class="botText"><span>I am a chatbot. You can begin conversation by typing in a message and pressing enter.</span></p>
      </div>
      <div id="userInput" class="flex flex-wrap">
        <input id="textInput" type="text" name="msg" placeholder="Message">
        <input id="buttonInput" type="submit" value="Send">
      </div>
      <script>
        var orderinit=false;
        var pizza=false;
        var type=false;
        var size=false;
        var count=false;
        var contact=false;
        var names=false;
        var mob=false;
        var address=false;
        order={};
        function makeid(length) {
          var result           = '';
          var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
          var charactersLength = characters.length;
          for ( var i = 0; i < length; i++ ) {
              result += characters.charAt(Math.floor(Math.random() * charactersLength));
          }
          return result;
        }
        function getBotResponse() {
          var rawText = $("#textInput").val();
          console.log(rawText);
          if(rawText === "order pizza" || rawText==="Order pizza" || rawText==="Order init" || rawText==="order init")
          {
            orderinit=true;
            console.log("order initialied")
            var userHtml = '<p class="userText"><span>' + rawText + '</span></p>';
            $("#textInput").val("");
            $("#chatbox").append(userHtml);
            document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
            var botHtml = '<p class="botText"><span>Enter a or b for veg or non veg</span></p>';
            $("#chatbox").append(botHtml);
            document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
          }
          if(orderinit===true)
          {
            if(pizza===false)
            {
              if(type===false)
              {
                if(rawText.toUpperCase()==='A')
                {
                  order["type"]="veg";
                  type=true;

                  var userHtml = '<p class="userText"><span>' + rawText + '</span></p>';
                  $("#textInput").val("");
                  $("#chatbox").append(userHtml);
                  document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                  var botHtml = '<p class="botText"><span>Enter a or b or c for regular, medium, large</span></p>';
                  $("#chatbox").append(botHtml);
                  document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                }
                else if(rawText.toUpperCase()==='B')
                {
                  order["type"]="Non veg";
                  type=true;

                  var userHtml = '<p class="userText"><span>' + rawText + '</span></p>';
                  $("#textInput").val("");
                  $("#chatbox").append(userHtml);
                  document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                  var botHtml = '<p class="botText"><span>Enter a or b or c for regular, medium, large</span></p>';
                  $("#chatbox").append(botHtml);
                  document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                }
                else
                {
                  console.log("enter correct options");
                }
              }
              else if(size===false)
              {
                if(rawText.toUpperCase()==='A')
                {
                  order["size"]="regular";
                  size=true;

                  var userHtml = '<p class="userText"><span>' + rawText + '</span></p>';
                  $("#textInput").val("");
                  $("#chatbox").append(userHtml);
                  document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                  var botHtml = '<p class="botText"><span>Enter number of pizza</span></p>';
                  $("#chatbox").append(botHtml);
                  document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                }
                else if(rawText.toUpperCase()==='B')
                {
                  order["size"]="medium";
                  size=true;

                  var userHtml = '<p class="userText"><span>' + rawText + '</span></p>';
                  $("#textInput").val("");
                  $("#chatbox").append(userHtml);
                  document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                  var botHtml = '<p class="botText"><span>Enter number of pizza</span></p>';
                  $("#chatbox").append(botHtml);
                  document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                }
                else if(rawText.toUpperCase()==='C')
                {
                  order["size"]="small";
                  size=true;

                  var userHtml = '<p class="userText"><span>' + rawText + '</span></p>';
                  $("#textInput").val("");
                  $("#chatbox").append(userHtml);
                  document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                  var botHtml = '<p class="botText"><span>Enter number of pizza</span></p>';
                  $("#chatbox").append(botHtml);
                  document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                }
                else
                {
                  console.log("enter correct option")
                }
              }
              else if(count===false)
              {
                console.log(parseInt(rawText))
                order["count"]=parseInt(rawText);
                count=true
                pizza=true

                var userHtml = '<p class="userText"><span>' + rawText + '</span></p>';
                $("#textInput").val("");
                $("#chatbox").append(userHtml);
                document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                var botHtml = '<p class="botText"><span>Enter your name</span></p>';
                $("#chatbox").append(botHtml);
                document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
              }
            }
            else if(pizza===true && contact===false)
            {
              if(names===false)
              {
                order["name"]=rawText;
                names=true;

                var userHtml = '<p class="userText"><span>' + rawText + '</span></p>';
                $("#textInput").val("");
                $("#chatbox").append(userHtml);
                document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                var botHtml = '<p class="botText"><span>Enter your number</span></p>';
                $("#chatbox").append(botHtml);
                document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
              }
              else if(mob===false)
              {
                order["mob"]=parseInt(rawText);
                mob=true

                var userHtml = '<p class="userText"><span>' + rawText + '</span></p>';
                $("#textInput").val("");
                $("#chatbox").append(userHtml);
                document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                var botHtml = '<p class="botText"><span>Enter your address</span></p>';
                $("#chatbox").append(botHtml);
                document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
              }
              else if(address===false)
              {
                order["address"]=rawText
                address=true
                contact=true

                var userHtml = '<p class="userText"><span>' + rawText + '</span></p>';
                $("#textInput").val("");
                $("#chatbox").append(userHtml);
                document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                var orderid=makeid(5);
                var botHtml = '<p class="botText"><span>your order ID is '+orderid+'</span></p>';
                $("#chatbox").append(botHtml);
                document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
                order["orderid"]=orderid;
              }
            }
            if(pizza===true && contact===true)
            {
              $.get("/order", { msg:JSON.stringify(order) }).done(function(data) {
              var botHtml = '<p class="botText"><span>' + data + '</span></p>';
              $("#chatbox").append(botHtml);
              document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
            });
              orderinit=false
            }
            console.log(order);
          }
          else
          {
            var userHtml = '<p class="userText"><span>' + rawText + '</span></p>';
            $("#textInput").val("");
            $("#chatbox").append(userHtml);
            document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
            $.get("/get", { msg: rawText }).done(function(data) {
              var botHtml = '<p class="botText"><span>' + data + '</span></p>';
              $("#chatbox").append(botHtml);
              document.getElementById('userInput').scrollIntoView({block: 'start', behavior: 'smooth'});
            });
          }

        }
        $("#textInput").keypress(function(e) {
            if(e.which == 13) {
                getBotResponse();
            }
        });
        $("#buttonInput").click(function() {
          getBotResponse();
        })
      </script>
    </div>
  </div>
  </body>
</html>